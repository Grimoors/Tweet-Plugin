{"id":"VG6P","dependencies":[{"name":"C:\\Users\\user\\Documents\\GitHub\\Tweet-Plugin\\package.json","includedInParent":true,"mtime":1681685714954},{"name":"C:\\Users\\user\\Documents\\GitHub\\Tweet-Plugin\\node_modules\\natural\\package.json","includedInParent":true,"mtime":1681673273006},{"name":"./Feature","loc":{"line":26,"column":24,"index":1183},"parent":"C:\\Users\\user\\Documents\\GitHub\\Tweet-Plugin\\node_modules\\natural\\lib\\natural\\classifiers\\maxent\\GISScaler.js","resolved":"C:\\Users\\user\\Documents\\GitHub\\Tweet-Plugin\\node_modules\\natural\\lib\\natural\\classifiers\\maxent\\Feature.js"},{"name":"./Distribution","loc":{"line":27,"column":29,"index":1226},"parent":"C:\\Users\\user\\Documents\\GitHub\\Tweet-Plugin\\node_modules\\natural\\lib\\natural\\classifiers\\maxent\\GISScaler.js","resolved":"C:\\Users\\user\\Documents\\GitHub\\Tweet-Plugin\\node_modules\\natural\\lib\\natural\\classifiers\\maxent\\Distribution.js"}],"generated":{"js":"\"use strict\";const t=require(\"./Feature\"),e=require(\"./Distribution\");function r(t,e){this.featureSet=t,this.sample=e}r.prototype.calculateMaxSumOfFeatures=function(){const t=this;this.C=0,this.featureSums={};const e=[];return this.sample.elements.forEach(function(r){if(!t.featureSums[r.toString()]){let i=0;t.featureSet.getFeatures().forEach(function(t){i+=t.apply(r)}),i>t.C&&(t.C=i),t.featureSums[r.toString()]=i,e.push(i)}}),e.sort(function(t,e){return t-e}),e[0]!==e[e.length-1]},r.prototype.addCorrectionFeature=function(){if(this.calculateMaxSumOfFeatures()){const e=this;const r=new t(function(t){return void 0!==e.featureSums[t.toString()]?e.C-e.featureSums[t.toString()]:0},\"Correction feature\",[]);this.featureSet.addFeature(r)}},r.prototype.run=function(t,r){this.iteration=0,this.improvement=0,this.addCorrectionFeature();const i=new Array(this.featureSet.size());for(let e=0;e<i.length;e++)i[e]=1;const s=new e(i,this.featureSet,this.sample);s.prepare();let a=s.KullbackLieblerDistance();const n=new Array(this.featureSet.size());let o=0,u=0;do{for(let e=0;e<this.featureSet.size();e++)o=this.featureSet.getFeatures()[e].observedExpectation(this.sample),u=this.featureSet.getFeatures()[e].expectationApprox(s,this.sample),n[e]=s.alpha[e]*Math.pow(o/u,1/this.C);n.forEach(function(t,e){s.alpha[e]=t}),s.prepare(),this.iteration++;const t=s.KullbackLieblerDistance();this.improvement=a-t,a=t}while(this.iteration<t&&this.improvement>r);return s},module.exports=r;"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":24,"column":0},"generated":{"line":1,"column":0}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":26,"column":0},"generated":{"line":1,"column":13}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Feature","original":{"line":26,"column":6},"generated":{"line":1,"column":19}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"require","original":{"line":26,"column":16},"generated":{"line":1,"column":21}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":26,"column":24},"generated":{"line":1,"column":29}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Distribution","original":{"line":27,"column":6},"generated":{"line":1,"column":42}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"require","original":{"line":27,"column":21},"generated":{"line":1,"column":44}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":27,"column":29},"generated":{"line":1,"column":52}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":31,"column":0},"generated":{"line":1,"column":70}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"GISScaler","original":{"line":31,"column":9},"generated":{"line":1,"column":79}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":31,"column":20},"generated":{"line":1,"column":81}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":31,"column":32},"generated":{"line":1,"column":83}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":32,"column":2},"generated":{"line":1,"column":86}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":32,"column":7},"generated":{"line":1,"column":91}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":32,"column":20},"generated":{"line":1,"column":102}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":33,"column":2},"generated":{"line":1,"column":104}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":33,"column":7},"generated":{"line":1,"column":109}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":33,"column":16},"generated":{"line":1,"column":116}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"GISScaler","original":{"line":37,"column":0},"generated":{"line":1,"column":118}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"prototype","original":{"line":37,"column":10},"generated":{"line":1,"column":120}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"calculateMaxSumOfFeatures","original":{"line":37,"column":20},"generated":{"line":1,"column":130}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":37,"column":48},"generated":{"line":1,"column":156}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":38,"column":2},"generated":{"line":1,"column":167}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":38,"column":8},"generated":{"line":1,"column":173}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":38,"column":15},"generated":{"line":1,"column":175}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":39,"column":2},"generated":{"line":1,"column":180}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"C","original":{"line":39,"column":7},"generated":{"line":1,"column":185}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":39,"column":11},"generated":{"line":1,"column":187}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":40,"column":2},"generated":{"line":1,"column":189}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSums","original":{"line":40,"column":7},"generated":{"line":1,"column":194}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":40,"column":21},"generated":{"line":1,"column":206}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":41,"column":2},"generated":{"line":1,"column":209}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"listOfSumValues","original":{"line":41,"column":8},"generated":{"line":1,"column":215}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":41,"column":26},"generated":{"line":1,"column":217}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":65,"column":2},"generated":{"line":1,"column":220}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":46,"column":2},"generated":{"line":1,"column":227}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":46,"column":7},"generated":{"line":1,"column":232}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"elements","original":{"line":46,"column":14},"generated":{"line":1,"column":239}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"forEach","original":{"line":46,"column":23},"generated":{"line":1,"column":248}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":46,"column":31},"generated":{"line":1,"column":256}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":46,"column":41},"generated":{"line":1,"column":265}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":47,"column":4},"generated":{"line":1,"column":268}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":47,"column":9},"generated":{"line":1,"column":272}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSums","original":{"line":47,"column":14},"generated":{"line":1,"column":274}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":47,"column":26},"generated":{"line":1,"column":286}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"toString","original":{"line":47,"column":28},"generated":{"line":1,"column":288}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":47,"column":41},"generated":{"line":1,"column":300}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":48,"column":6},"generated":{"line":1,"column":301}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sum","original":{"line":48,"column":10},"generated":{"line":1,"column":305}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":48,"column":16},"generated":{"line":1,"column":307}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":49,"column":6},"generated":{"line":1,"column":309}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":49,"column":11},"generated":{"line":1,"column":311}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"getFeatures","original":{"line":49,"column":22},"generated":{"line":1,"column":322}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"forEach","original":{"line":49,"column":36},"generated":{"line":1,"column":336}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":49,"column":44},"generated":{"line":1,"column":344}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"f","original":{"line":49,"column":54},"generated":{"line":1,"column":353}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sum","original":{"line":50,"column":8},"generated":{"line":1,"column":356}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"f","original":{"line":50,"column":15},"generated":{"line":1,"column":359}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"apply","original":{"line":50,"column":17},"generated":{"line":1,"column":361}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":50,"column":23},"generated":{"line":1,"column":367}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sum","original":{"line":52,"column":10},"generated":{"line":1,"column":372}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":52,"column":16},"generated":{"line":1,"column":374}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"C","original":{"line":52,"column":21},"generated":{"line":1,"column":376}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":53,"column":8},"generated":{"line":1,"column":380}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"C","original":{"line":53,"column":13},"generated":{"line":1,"column":382}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sum","original":{"line":53,"column":17},"generated":{"line":1,"column":384}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":55,"column":6},"generated":{"line":1,"column":387}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSums","original":{"line":55,"column":11},"generated":{"line":1,"column":389}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":55,"column":23},"generated":{"line":1,"column":401}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"toString","original":{"line":55,"column":25},"generated":{"line":1,"column":403}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sum","original":{"line":55,"column":39},"generated":{"line":1,"column":415}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"listOfSumValues","original":{"line":56,"column":6},"generated":{"line":1,"column":417}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"push","original":{"line":56,"column":22},"generated":{"line":1,"column":419}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sum","original":{"line":56,"column":27},"generated":{"line":1,"column":424}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"listOfSumValues","original":{"line":62,"column":2},"generated":{"line":1,"column":430}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sort","original":{"line":62,"column":18},"generated":{"line":1,"column":432}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":62,"column":23},"generated":{"line":1,"column":437}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"a","original":{"line":62,"column":33},"generated":{"line":1,"column":446}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"b","original":{"line":62,"column":36},"generated":{"line":1,"column":448}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":63,"column":4},"generated":{"line":1,"column":451}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"a","original":{"line":63,"column":11},"generated":{"line":1,"column":458}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"b","original":{"line":63,"column":15},"generated":{"line":1,"column":460}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"listOfSumValues","original":{"line":65,"column":10},"generated":{"line":1,"column":464}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":65,"column":26},"generated":{"line":1,"column":466}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"listOfSumValues","original":{"line":65,"column":33},"generated":{"line":1,"column":471}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"listOfSumValues","original":{"line":65,"column":49},"generated":{"line":1,"column":473}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"length","original":{"line":65,"column":65},"generated":{"line":1,"column":475}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":65,"column":74},"generated":{"line":1,"column":482}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"GISScaler","original":{"line":68,"column":0},"generated":{"line":1,"column":486}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"prototype","original":{"line":68,"column":10},"generated":{"line":1,"column":488}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"addCorrectionFeature","original":{"line":68,"column":20},"generated":{"line":1,"column":498}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":68,"column":43},"generated":{"line":1,"column":519}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":69,"column":2},"generated":{"line":1,"column":530}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":69,"column":6},"generated":{"line":1,"column":533}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"calculateMaxSumOfFeatures","original":{"line":69,"column":11},"generated":{"line":1,"column":538}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":69,"column":40},"generated":{"line":1,"column":566}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":71,"column":4},"generated":{"line":1,"column":567}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":71,"column":10},"generated":{"line":1,"column":573}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":71,"column":17},"generated":{"line":1,"column":575}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":80,"column":4},"generated":{"line":1,"column":580}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"correctionFeature","original":{"line":80,"column":10},"generated":{"line":1,"column":586}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":80,"column":30},"generated":{"line":1,"column":588}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Feature","original":{"line":80,"column":34},"generated":{"line":1,"column":592}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":73,"column":4},"generated":{"line":1,"column":594}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":73,"column":16},"generated":{"line":1,"column":603}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":74,"column":6},"generated":{"line":1,"column":606}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"undefined","original":{"line":74,"column":45},"generated":{"line":1,"column":618}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":74,"column":10},"generated":{"line":1,"column":622}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSums","original":{"line":74,"column":15},"generated":{"line":1,"column":624}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":74,"column":27},"generated":{"line":1,"column":636}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"toString","original":{"line":74,"column":29},"generated":{"line":1,"column":638}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":75,"column":15},"generated":{"line":1,"column":650}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"C","original":{"line":75,"column":20},"generated":{"line":1,"column":652}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"that","original":{"line":75,"column":24},"generated":{"line":1,"column":654}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSums","original":{"line":75,"column":29},"generated":{"line":1,"column":656}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"x","original":{"line":75,"column":41},"generated":{"line":1,"column":668}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"toString","original":{"line":75,"column":43},"generated":{"line":1,"column":670}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":77,"column":13},"generated":{"line":1,"column":682}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":80,"column":45},"generated":{"line":1,"column":685}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":80,"column":67},"generated":{"line":1,"column":706}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":82,"column":4},"generated":{"line":1,"column":710}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":82,"column":9},"generated":{"line":1,"column":715}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"addFeature","original":{"line":82,"column":20},"generated":{"line":1,"column":726}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"correctionFeature","original":{"line":82,"column":31},"generated":{"line":1,"column":737}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"GISScaler","original":{"line":92,"column":0},"generated":{"line":1,"column":742}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"prototype","original":{"line":92,"column":10},"generated":{"line":1,"column":744}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"run","original":{"line":92,"column":20},"generated":{"line":1,"column":754}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":92,"column":26},"generated":{"line":1,"column":758}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"maxIterations","original":{"line":92,"column":36},"generated":{"line":1,"column":767}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"minImprovement","original":{"line":92,"column":51},"generated":{"line":1,"column":769}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":93,"column":2},"generated":{"line":1,"column":772}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"iteration","original":{"line":93,"column":7},"generated":{"line":1,"column":777}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":93,"column":19},"generated":{"line":1,"column":787}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":94,"column":2},"generated":{"line":1,"column":789}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"improvement","original":{"line":94,"column":7},"generated":{"line":1,"column":794}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":94,"column":21},"generated":{"line":1,"column":806}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":96,"column":2},"generated":{"line":1,"column":808}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"addCorrectionFeature","original":{"line":96,"column":7},"generated":{"line":1,"column":813}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":98,"column":2},"generated":{"line":1,"column":836}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"alpha","original":{"line":98,"column":8},"generated":{"line":1,"column":842}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":98,"column":16},"generated":{"line":1,"column":844}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Array","original":{"line":98,"column":20},"generated":{"line":1,"column":848}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":98,"column":26},"generated":{"line":1,"column":854}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":98,"column":31},"generated":{"line":1,"column":859}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"size","original":{"line":98,"column":42},"generated":{"line":1,"column":870}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":99,"column":2},"generated":{"line":1,"column":878}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":99,"column":7},"generated":{"line":1,"column":882}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":99,"column":11},"generated":{"line":1,"column":886}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":99,"column":15},"generated":{"line":1,"column":888}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":99,"column":18},"generated":{"line":1,"column":890}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"alpha","original":{"line":99,"column":22},"generated":{"line":1,"column":892}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"length","original":{"line":99,"column":28},"generated":{"line":1,"column":894}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":99,"column":36},"generated":{"line":1,"column":901}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"alpha","original":{"line":100,"column":4},"generated":{"line":1,"column":905}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":100,"column":10},"generated":{"line":1,"column":907}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":100,"column":15},"generated":{"line":1,"column":910}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":102,"column":2},"generated":{"line":1,"column":912}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":102,"column":8},"generated":{"line":1,"column":918}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":102,"column":12},"generated":{"line":1,"column":920}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Distribution","original":{"line":102,"column":16},"generated":{"line":1,"column":924}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"alpha","original":{"line":102,"column":29},"generated":{"line":1,"column":926}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":102,"column":36},"generated":{"line":1,"column":928}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":102,"column":41},"generated":{"line":1,"column":933}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":102,"column":53},"generated":{"line":1,"column":944}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":102,"column":58},"generated":{"line":1,"column":949}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":104,"column":2},"generated":{"line":1,"column":957}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"prepare","original":{"line":104,"column":4},"generated":{"line":1,"column":959}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":106,"column":2},"generated":{"line":1,"column":969}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"KLDistance","original":{"line":106,"column":6},"generated":{"line":1,"column":973}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":106,"column":19},"generated":{"line":1,"column":975}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"KullbackLieblerDistance","original":{"line":106,"column":21},"generated":{"line":1,"column":977}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":108,"column":2},"generated":{"line":1,"column":1003}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newAlpha","original":{"line":108,"column":8},"generated":{"line":1,"column":1009}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":108,"column":19},"generated":{"line":1,"column":1011}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Array","original":{"line":108,"column":23},"generated":{"line":1,"column":1015}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":108,"column":29},"generated":{"line":1,"column":1021}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":108,"column":34},"generated":{"line":1,"column":1026}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"size","original":{"line":108,"column":45},"generated":{"line":1,"column":1037}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":109,"column":2},"generated":{"line":1,"column":1045}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"observedExpectation","original":{"line":109,"column":6},"generated":{"line":1,"column":1049}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":109,"column":28},"generated":{"line":1,"column":1051}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"expectationApprox","original":{"line":110,"column":6},"generated":{"line":1,"column":1053}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":110,"column":26},"generated":{"line":1,"column":1055}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":111,"column":2},"generated":{"line":1,"column":1057}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":111,"column":5},"generated":{"line":1,"column":1059}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":113,"column":4},"generated":{"line":1,"column":1060}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":113,"column":9},"generated":{"line":1,"column":1064}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":113,"column":13},"generated":{"line":1,"column":1068}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":113,"column":17},"generated":{"line":1,"column":1070}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":113,"column":20},"generated":{"line":1,"column":1072}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":113,"column":24},"generated":{"line":1,"column":1074}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":113,"column":29},"generated":{"line":1,"column":1079}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"size","original":{"line":113,"column":40},"generated":{"line":1,"column":1090}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":113,"column":48},"generated":{"line":1,"column":1097}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"observedExpectation","original":{"line":114,"column":6},"generated":{"line":1,"column":1101}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":114,"column":28},"generated":{"line":1,"column":1103}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":114,"column":33},"generated":{"line":1,"column":1108}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"getFeatures","original":{"line":114,"column":44},"generated":{"line":1,"column":1119}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":114,"column":58},"generated":{"line":1,"column":1133}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"observedExpectation","original":{"line":114,"column":61},"generated":{"line":1,"column":1136}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":114,"column":81},"generated":{"line":1,"column":1156}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":114,"column":86},"generated":{"line":1,"column":1161}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"expectationApprox","original":{"line":115,"column":6},"generated":{"line":1,"column":1169}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":115,"column":26},"generated":{"line":1,"column":1171}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"featureSet","original":{"line":115,"column":31},"generated":{"line":1,"column":1176}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"getFeatures","original":{"line":115,"column":42},"generated":{"line":1,"column":1187}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":115,"column":56},"generated":{"line":1,"column":1201}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"expectationApprox","original":{"line":115,"column":59},"generated":{"line":1,"column":1204}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":115,"column":77},"generated":{"line":1,"column":1222}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":115,"column":80},"generated":{"line":1,"column":1224}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"sample","original":{"line":115,"column":85},"generated":{"line":1,"column":1229}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newAlpha","original":{"line":117,"column":6},"generated":{"line":1,"column":1237}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":117,"column":15},"generated":{"line":1,"column":1239}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":117,"column":20},"generated":{"line":1,"column":1242}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"alpha","original":{"line":117,"column":22},"generated":{"line":1,"column":1244}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"i","original":{"line":117,"column":28},"generated":{"line":1,"column":1250}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"Math","original":{"line":117,"column":33},"generated":{"line":1,"column":1253}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"pow","original":{"line":117,"column":38},"generated":{"line":1,"column":1258}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"observedExpectation","original":{"line":117,"column":42},"generated":{"line":1,"column":1262}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"expectationApprox","original":{"line":117,"column":64},"generated":{"line":1,"column":1264}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":117,"column":83},"generated":{"line":1,"column":1266}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":117,"column":87},"generated":{"line":1,"column":1268}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"C","original":{"line":117,"column":92},"generated":{"line":1,"column":1273}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newAlpha","original":{"line":124,"column":4},"generated":{"line":1,"column":1276}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"forEach","original":{"line":124,"column":13},"generated":{"line":1,"column":1278}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":124,"column":21},"generated":{"line":1,"column":1286}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newAlphaj","original":{"line":124,"column":31},"generated":{"line":1,"column":1295}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"j","original":{"line":124,"column":42},"generated":{"line":1,"column":1297}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":125,"column":6},"generated":{"line":1,"column":1300}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"alpha","original":{"line":125,"column":8},"generated":{"line":1,"column":1302}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"j","original":{"line":125,"column":14},"generated":{"line":1,"column":1308}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newAlphaj","original":{"line":125,"column":19},"generated":{"line":1,"column":1311}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":128,"column":4},"generated":{"line":1,"column":1315}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"prepare","original":{"line":128,"column":6},"generated":{"line":1,"column":1317}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":130,"column":4},"generated":{"line":1,"column":1327}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"iteration","original":{"line":130,"column":9},"generated":{"line":1,"column":1332}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":131,"column":4},"generated":{"line":1,"column":1344}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newKLDistance","original":{"line":131,"column":10},"generated":{"line":1,"column":1350}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":131,"column":26},"generated":{"line":1,"column":1352}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"KullbackLieblerDistance","original":{"line":131,"column":28},"generated":{"line":1,"column":1354}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":132,"column":4},"generated":{"line":1,"column":1380}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"improvement","original":{"line":132,"column":9},"generated":{"line":1,"column":1385}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"KLDistance","original":{"line":132,"column":23},"generated":{"line":1,"column":1397}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newKLDistance","original":{"line":132,"column":36},"generated":{"line":1,"column":1399}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"KLDistance","original":{"line":136,"column":4},"generated":{"line":1,"column":1401}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"newKLDistance","original":{"line":136,"column":17},"generated":{"line":1,"column":1403}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":137,"column":12},"generated":{"line":1,"column":1411}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"iteration","original":{"line":137,"column":17},"generated":{"line":1,"column":1416}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"maxIterations","original":{"line":137,"column":29},"generated":{"line":1,"column":1426}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":137,"column":48},"generated":{"line":1,"column":1429}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"improvement","original":{"line":137,"column":53},"generated":{"line":1,"column":1434}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"minImprovement","original":{"line":137,"column":67},"generated":{"line":1,"column":1446}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","original":{"line":147,"column":2},"generated":{"line":1,"column":1449}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"p","original":{"line":147,"column":9},"generated":{"line":1,"column":1456}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"module","original":{"line":150,"column":0},"generated":{"line":1,"column":1459}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"exports","original":{"line":150,"column":7},"generated":{"line":1,"column":1466}},{"source":"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js","name":"GISScaler","original":{"line":150,"column":17},"generated":{"line":1,"column":1474}}],"sources":{"node_modules/natural/lib/natural/classifiers/maxent/GISScaler.js":"/*\r\nGISScaler class that finds parameters of features\r\nCopyright (C) 2017 Hugo W.L. ter Doest\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n'use strict'\r\n\r\nconst Feature = require('./Feature')\r\nconst Distribution = require('./Distribution')\r\n\r\n// classes is an array of classes\r\n// features is an array of feature functions\r\nfunction GISScaler (featureSet, sample) {\r\n  this.featureSet = featureSet\r\n  this.sample = sample\r\n}\r\n\r\n// Returns true if a correction feature is necessary\r\nGISScaler.prototype.calculateMaxSumOfFeatures = function () {\r\n  const that = this\r\n  this.C = 0\r\n  this.featureSums = {}\r\n  const listOfSumValues = []\r\n\r\n  // Since feature functions are derived from the sample\r\n  // we can use the sample to calculate the max sum\r\n  // We look at each sample element only once\r\n  this.sample.elements.forEach(function (x) {\r\n    if (!that.featureSums[x.toString()]) {\r\n      let sum = 0\r\n      that.featureSet.getFeatures().forEach(function (f) {\r\n        sum += f.apply(x)\r\n      })\r\n      if (sum > that.C) {\r\n        that.C = sum\r\n      }\r\n      that.featureSums[x.toString()] = sum\r\n      listOfSumValues.push(sum)\r\n    }\r\n  })\r\n  // console.log(\"GISScaler:calculateMaxSumOfFeatures:maxSum is \" + this.C);\r\n\r\n  // Check if a correction feature is necessary\r\n  listOfSumValues.sort(function (a, b) {\r\n    return a - b\r\n  })\r\n  return (listOfSumValues[0] !== listOfSumValues[listOfSumValues.length - 1])\r\n}\r\n\r\nGISScaler.prototype.addCorrectionFeature = function () {\r\n  if (this.calculateMaxSumOfFeatures()) {\r\n    // console.log(\"GISScaler:addCorrectionFeature:C is \" + this.C);\r\n    const that = this\r\n\r\n    function f (x) {\r\n      if (that.featureSums[x.toString()] !== undefined) {\r\n        return that.C - that.featureSums[x.toString()]\r\n      }\r\n      return 0\r\n    }\r\n\r\n    const correctionFeature = new Feature(f, 'Correction feature', [])\r\n    // console.log(\"GISScaler:addCorrectionFeature:correctionFeature \" + JSON.stringify(correctionFeature));\r\n    this.featureSet.addFeature(correctionFeature)\r\n  } else {\r\n    // console.log(\"Correction feature not needed\");\r\n  }\r\n}\r\n\r\n// This is the Generalised Iterative Scaling algorithm\r\n// It ends if the improvement in likelihood of the distribution does not\r\n// improve more than minImprovement or if the maximum number of iterations is\r\n// reached.\r\nGISScaler.prototype.run = function (maxIterations, minImprovement) {\r\n  this.iteration = 0\r\n  this.improvement = 0\r\n\r\n  this.addCorrectionFeature()\r\n  // Build up the distribution p\r\n  const alpha = new Array(this.featureSet.size())\r\n  for (let i = 0; i < alpha.length; i++) {\r\n    alpha[i] = 1\r\n  }\r\n  const p = new Distribution(alpha, this.featureSet, this.sample)\r\n  // console.log(\"Distribution created\");\r\n  p.prepare()\r\n  // console.log(\"Distribution prepared\");\r\n  let KLDistance = p.KullbackLieblerDistance()\r\n\r\n  const newAlpha = new Array(this.featureSet.size())\r\n  let observedExpectation = 0\r\n  let expectationApprox = 0\r\n  do {\r\n    // console.log(\"Iteration \" + this.iteration + \" - Log likelihood of sample: \" + likelihood + \" - Entropy: \" + p.entropy());\r\n    for (let i = 0; i < this.featureSet.size(); i++) {\r\n      observedExpectation = this.featureSet.getFeatures()[i].observedExpectation(this.sample)\r\n      expectationApprox = this.featureSet.getFeatures()[i].expectationApprox(p, this.sample)\r\n      // console.log(\"Iteration \" + this.iteration + \" - Feature \" + i);\r\n      newAlpha[i] = p.alpha[i] * Math.pow(observedExpectation / expectationApprox, 1 / this.C)\r\n\r\n      // console.log(\"GISScaler.run: old alpha[\" + i + \"]: \" + p.alpha[i]);\r\n      // console.log(\"GISScaler.run: new alpha[\" + i + \"]: \" + newAlpha[i]);\r\n    }\r\n\r\n    // Make the newly calculated parameters current parameters\r\n    newAlpha.forEach(function (newAlphaj, j) {\r\n      p.alpha[j] = newAlphaj\r\n    })\r\n    // Recalculate a priori and a posteriori probabilities\r\n    p.prepare()\r\n\r\n    this.iteration++\r\n    const newKLDistance = p.KullbackLieblerDistance()\r\n    this.improvement = KLDistance - newKLDistance\r\n    // console.log(\"Iteration \" + this.iteration + \" - Old likelihood: \" + likelihood + \" - New likelihood: \" + newLikelihood);\r\n    // console.log(\"Iteration \" + this.iteration + \" - Old KL: \" + KLDistance + \" - New KL: \" + newKLDistance);\r\n\r\n    KLDistance = newKLDistance\r\n  } while ((this.iteration < maxIterations) && (this.improvement > minImprovement))\r\n  // } while (iteration < maxIterations);\r\n  /*\r\n  var that = this;\r\n  this.featureSet.getFeatures().forEach(function(f, j) {\r\n    console.log(\"Observed expectation of feature \" + j + \": \" + f.observedExpectation(that.sample) +\r\n      \" - Expection of feature according to p: \" + f.expectationApprox(p, that.sample));\r\n  });\r\n  */\r\n\r\n  return p\r\n}\r\n\r\nmodule.exports = GISScaler\r\n"},"lineCount":null}},"error":null,"hash":"128f5311164bef388b8c388f4c8dc3b8","cacheData":{"env":{}}}